{% extends "layout.html" %}

{% block content %}
<style>
.admin-dashboard {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    min-height: 100vh;
    padding: 40px 20px;
}

.toggle-buttons {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 3rem;
    flex-wrap: wrap;
}

.toggle-btn {
    width: 260px;
    height: 150px;
    border-radius: 20px;
    background: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    text-align: center;
    cursor: pointer;
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.toggle-btn.active {
    border-color: #0d6efd;
    background: #e7f1ff;
}

.toggle-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.toggle-btn i {
    font-size: 2.8rem;
    color: #0d6efd;
    margin-bottom: 10px;
}

.section {
    display: none;
}
.section.active {
    display: block;
}
</style>

<div class="admin-dashboard container">
    <h1 class="text-primary text-center mb-4">ðŸ“š Admin Dashboard</h1>
    <p class="text-center text-muted mb-5">Manage Users, Books, and Issued Records</p>

    <!-- Toggle Buttons -->
    <div class="toggle-buttons">
        <div class="toggle-btn active" data-section="users">
            <i class="bi bi-people-fill"></i>
            <h5>User Management</h5>
        </div>
        <div class="toggle-btn" data-section="books">
            <i class="bi bi-book-half"></i>
            <h5>Books</h5>
        </div>
        <div class="toggle-btn" data-section="issued">
            <i class="bi bi-journal-check"></i>
            <h5>Issued Books</h5>
        </div>
    </div>

    <!-- User Management Section -->
    <div id="section-users" class="section active">
        <div class="text-center my-4">
            <h2>Manage Users</h2>
            <p>View or delete user accounts.</p>
        </div>
        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Username</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.username }}</td>
                    <td>
                        <a href="{{ url_for('delete_user', user_id=user.id) }}" class="btn btn-danger btn-sm"
                            onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Books Section -->
    <div id="section-books" class="section">
        <h2>Books</h2>
        {% if books %}
            <div class="row mt-4">
                {% for book in books %}
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header text-white bg-primary d-flex justify-content-between">
                                <span><h4>{{ book.book_name }}</h4></span>
                                <span>
                                    <a href="{{ url_for('edit_book', book_id=book.id) }}" class="btn btn-secondary btn-sm">Edit</a> 
                                    <a href="{{ url_for('delete_book', book_id=book.id) }}" class="btn btn-danger btn-sm"
                                       onclick="return confirm('Are you sure you want to delete this book?');">
                                        Delete
                                    </a>
                                </span>
                            </div>
                            <div class="card-body">
                                <p><strong>Author:</strong> {{ book.book_author }}</p>
                                <p><strong>Publication Year:</strong> {{ book.pub_year }}</p>
                                <p><strong>Issued:</strong> {{ 'Yes' if book.is_issue else 'No' }}</p>
                                <p><strong>Total Copies:</strong> {{ book.total_copies }}</p>
                                <p><strong>Available Copies:</strong> {{ book.available_copies }}</p>
                                <p><strong>Description:</strong> {{ book.description }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
                <div class="mt-4 text-center">
                    <a class="btn btn-warning" href="{{ url_for('new_book') }}">+ Add Book</a>
                </div>
            </div>
        {% else %}
            <p>No Books found.</p>
            <div class="mt-4 text-center">
                <a class="btn btn-warning" href="{{ url_for('new_book') }}">+ Add Book</a>
            </div>
        {% endif %}
    </div>

    <!-- Issued Books Section -->
    <div id="section-issued" class="section">
        <h2>Issued Books</h2>
        {% if transactions %}
            <div class="table-responsive mt-3">
                <table class="table table-bordered table-striped align-middle">
                    <thead class="table-primary text-center">
                        <tr>
                            <th>Book Name</th>
                            <th>Author</th>
                            <th>User Name</th>
                            <th>User Email</th>
                            <th>Issued Date</th>
                            <th>Return Date</th>
                            <th>Due Date</th>
                            <th>Return Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in transactions %}
                            <tr>
                                <td>{{ t.book.book_name }}</td>
                                <td>{{ t.book.book_author }}</td>
                                <td>{{ t.user.username }}</td>
                                <td>{{ t.user.email }}</td>
                                <td>{{ t.issue_date if t.issue_date else 'N/A' }}</td>
                                <td>{{ t.return_date if t.return_date else 'N/A' }}</td>
                                <td>{{ t.due_date if t.due_date else 'N/A' }}</td>
                                <td>
                                    {% if t.is_returned %}
                                        <span class="badge bg-success">Returned</span>
                                    {% else %}
                                        <span class="badge bg-danger">Not Returned</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p class="text-muted mt-3">No issued books found.</p>
        {% endif %}
    </div>
</div>

<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

<script>
// Toggle section visibility
document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        // Remove active class from all buttons
        document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        // Hide all sections
        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        // Activate the selected one
        btn.classList.add('active');
        document.querySelector(`#section-${btn.dataset.section}`).classList.add('active');
    });
});
</script>
{% endblock %}
